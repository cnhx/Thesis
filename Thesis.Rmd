---
title: "R Notebook"
output: html_notebook
---
## Original

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
plot(cars)
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

## General Pipeline

![](https://ws1.sinaimg.cn/large/006tNbRwly1fxlt9qu667j311d0u0n89.jpg)

## Data Collection
Collect data through [Steam API](https://partner.steamgames.com/doc/store/getreviews).

```{r}
# Load packages

library(tidyverse)
library(httr)
library(jsonlite)
library(plyr)
library(dplyr)

#Save appid
appid <- 570

#Base URL
url_steam <- 'https://store.steampowered.com/appreviews/'

#Construct API Request
repos <- GET(url = paste0(url_steam,'/',appid,'?json=1?offset'))

#Exmain response components
names(repos)

#Check Status, only 200 is fine
status_code(repos)

#Get Content from Repo
repo_content <- content(repos)

dfrepo <- as.data.frame(repo_content)
repo_reviews <- repo_content$reviews
repo_reviews <-as.data.frame(repo_reviews)

dfsteamrepo <-data.frame()
rawReviews <-data.frame()
num = 20
while(num<=500000){  #Set limit
        repos<- fromJSON(paste0(url_steam,'/',appid,'?json=1?offset=',num))
        cat("Offset now is", num)
        cat("\n")
        reviews <- repos$reviews
        flatten(reviews,recursive = TRUE)
        # dfsteamrepo <- c(dfsteamrepo,steamrepo$reviews) 
        rownames(repos$reviews) <-make.names(c((num-19):num),unique = TRUE) #Try to solve dumplicate row name issue
        rownames(repos$reviews$author)<-make.names(c((num-19):num),unique = TRUE)
        rawReviews<- rbind(rawReviews,repos$reviews)
        num <- num + 20
}

##Write data to a txt file
write.table(rawReviews,"./Data/rawData.txt", sep="\t")

```

Subset the reviews from the rawData

```{r}
rawData <- read.table("./Data/rawData.txt", sep ="\t")
head(rawData)
```


## Data Preprocessing

## Data Analyze

## Topic Modeling Analysis

## Result Visulization 